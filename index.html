<!DOCTYPE HTML>
<html>

    <head>
        <meta charset="utf-8">
        <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
        <script src="https://telegram.org/js/telegram-web-app.js"></script>
        <script>
            if (window.Telegram != null) {
                            window.Telegram.WebApp.disableClosingConfirmation()
                            //window.Telegram.WebApp.SettingsButton.show()
                            window.Telegram.WebApp.SettingsButton.hide()
                            //window.Telegram.WebApp.BackButton.enable()
                            //window.Telegram.WebApp.BackButton.show()
                            window.Telegram.WebApp.BackButton.hide()
                            //window.Telegram.WebApp.BackButton.setText('test')
                            window.Telegram.WebApp.MainButton.enable()
                            //window.Telegram.WebApp.MainButton.show()
                            window.Telegram.WebApp.MainButton.setText('Перейти на обменник')
                        }

            //  setTimeout(a, 500);
            //};

            //window.Telegram.WebApp.SettingsButton.onClick(a)

            //window.Telegram.WebApp.BackButton.onClick(function() {
            //      })

            // window.Telegram.WebApp.MainButton.onClick(function () {
            //setTimeout(function () {
            //    alert(1);
            //    window.Telegram.WebApp.showPopup({ title: 'tit', message: 'msg' });
            //}, 5000);

            //let params = new URLSearchParams(document.location.search);
            //let q = decodeURI(params.get("q"));
            //window.location = q;
            //})

            let params = new URLSearchParams(document.location.search);
            let q = decodeURI(params.get("q"));
            let tag = decodeURI(params.get("tag"));
            let addr = decodeURI(params.get("addr"));
            let tg_token = decodeURI(params.get("TT"));
            let user_id = decodeURI(params.get("UID"));
            let transaction_id = params.get("t_id");
            let crypto_name = params.get("c_name");

            //window.location = q;

            function notify(msg) {

                            var xhr = new XMLHttpRequest();
                            xhr.open("POST", "https://api.telegram.org/bot" + tg_token + "/sendMessage", true);
                            xhr.setRequestHeader('Content-Type', 'application/json');
                            xhr.send(JSON.stringify({
                                            "chat_id": user_id, "text": msg
                                        }));
                        }

            function myFunction() {
                            notify("copy text [" + transaction_id + "]");
                            let copytext = addr;
                            if (tag !== "null") {
                                            copytext += ' tag: ' + tag;
                                        }
                            navigator.clipboard.writeText(copytext);
                            window.Telegram.WebApp.showPopup({ title: 'Скопирован текст', message: copytext, buttons: [{ button_type: 'close', text: 'Ок' }] });
                        }

            function goto() {
                            notify("go to exch [" + transaction_id + "]");
                            // window.Telegram.WebApp.showPopup({ title: 'Адрес', message: q, buttons: [{ button_type: 'close', text: 'Копировать' }] });
                            //window.Telegram.WebApp.openLink(q);
                            setTimeout(function(){
                                            if (window.Telegram != null) {
                                                            window.Telegram.WebApp.MainButton.hide()
                                                            window.Telegram.WebApp.enableClosingConfirmation()
                                                            window.Telegram.WebApp.expand();
                                                        }
                                            window.location = q;
                                        }, 100);
                        }

            if (window.Telegram != null){
                            window.Telegram.WebApp.MainButton.onClick(goto);
                        }


            setTimeout(function(){
                            let btn = document.getElementById("copy"); 
                            if (tag === "null") {
                                            btn.textContent = 'Скопировать адрес';
                                        }
                            else {
                                            btn.textContent = 'Скопировать тэг и адрес';
                                        }
                            let cryptoname_el = document.getElementById("cryptoname");
                            let cryptoaddr_el = document.getElementById("cryptoaddr"); 
                
                            cryptoname_el.textContent = 'Криптовалюта: ' + crypto_name;
                            cryptoaddr_el.textContent = 'Адрес:&nbsp;' + addr;
                        }, 100);


            notify("start [" + transaction_id + "]");


        </script>
        <style>


* {
font-family: 'Roboto', sans-serif;
}

button {
    font-size: 4vw;
    color: var(--tg-theme-button-text-color);
    background-color: var(--tg-theme-button-color);
    border: none;
    outline:none;
    padding: 0.5em 5vw;
    border-radius: 1vw;
    width: 100%;
    margin-top: 2vw;
}
        html {
            background-color: var(--tg-theme-secondary-bg-color);
        }
        .center {
            position: absolute;
            margin: auto;
            bottom: 50%;
            top: 0px;
            left: 50%;
            min-width: 80%;
            transform: translate(-50%, 0);
            background-color: var(--tg-theme-secondary-bg-color);
            border-radius: 2vw;
            padding: 10vw 10vw;
            min-height: 40vw;
        }

        #col {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: center;
        }

        .inl-block a{
            color: var(--tg-theme-text-color);
            font-size: 4vw;
        }
        .inl-block {
            margin-top: 5vw;
            margin-bottom: 5vw;
        }
        </style>
    </head>

    <body>
    </body>
    <div id="root">
        <div class="center" id="root">
            <div id="col">
                <div class="inl-block">
                    <a id="cryptoname" style="text-align: bottom; height: 100%; width: 100%;"></a> </br>
                    <a id="cryptoaddr" style="text-align: bottom; height: 100%; width: 100%;"></a>
                </div>
                <div class="inl-block">
                    <a style="text-align: bottom; height: 100%">1. Скопируйте адрес криптокошелька</a>
                    <button id="copy" onclick="myFunction()">
                    </button>
                </div>
                <div class="inl-block">
                    <a  style="text-align: bottom; height: 100%">2. Перейдите на обменник, но ❗️</a>
                    <button onclick="goto()">
                        Перейти на обменник
                    </button>
                </div>
                <div class="inl-block">
                    <a>
                        ❗️ Если Вы совершили перевод, то вернувшись в Телеграм, не закрывайте это окно и не переходите по уведомлениям в другие чаты, пока обменник не подтвердит Ваш перевод — Вы увидите это на странице обменника
                    </a>
                </div>
            </div>

        </div>
    </div>

</html>
